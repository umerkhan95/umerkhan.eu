---
import { type BlogSchema } from "../content/config";
import BaseLayout from "./BaseLayout.astro";
import dayjs from "dayjs";
import localizedFormat from "dayjs/plugin/localizedFormat";
import { Image } from "astro:assets";

export interface Props extends BlogSchema {}

const { title, description, pubDate, updatedDate, heroImage, badge, tags = [] } = Astro.props;
dayjs.extend(localizedFormat);
const displayDate = dayjs(pubDate).format("MMMM D, YYYY");
const updateDisplayDate = updatedDate ? dayjs(updatedDate).format("MMMM D, YYYY") : null;

// Calculate reading time (rough estimate)
const content = await Astro.slots.render('default');
const words = content.split(/\s+/).length;
const readingTime = Math.ceil(words / 200);
---

<BaseLayout title={title} description={description} image={heroImage} ogType="article" geoPage="blog">
  <article class="py-10">
    <!-- Back Link -->
    <a
      href="/blog"
      class="inline-flex items-center gap-2 text-sm text-base-content/50 hover:text-base-content transition-colors mb-8"
    >
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
      </svg>
      Back to blog
    </a>

    <!-- Article Header -->
    <header class="mb-10">
      <!-- Meta -->
      <div class="flex flex-wrap items-center gap-3 mb-4">
        <time class="text-xs text-base-content/50 flex items-center gap-1.5">
          <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
          </svg>
          {displayDate}
        </time>
        <span class="text-base-content/20">·</span>
        <span class="text-xs text-base-content/50">{readingTime} min read</span>
        {badge && (
          <>
            <span class="text-base-content/20">·</span>
            <span class="px-2 py-0.5 text-[10px] font-medium uppercase tracking-wider bg-primary/10 text-primary rounded-full">
              {badge}
            </span>
          </>
        )}
      </div>

      <!-- Title -->
      <h1 class="text-3xl md:text-4xl font-bold tracking-tight text-base-content leading-tight mb-4">
        {title}
      </h1>

      <!-- Description -->
      <p class="text-lg text-base-content/60 leading-relaxed max-w-2xl">
        {description}
      </p>

      <!-- Tags -->
      {tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-6">
          {tags.map((tag) => (
            <a
              href={`/blog/tag/${tag}/`}
              class="px-3 py-1 text-xs font-medium text-base-content/60 bg-base-200/60 rounded-lg border border-base-300/50 hover:border-base-300 hover:text-base-content transition-all"
            >
              {tag}
            </a>
          ))}
        </div>
      )}

      <!-- Updated Notice -->
      {updateDisplayDate && (
        <p class="mt-6 text-xs text-base-content/40 flex items-center gap-1.5">
          <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
          </svg>
          Last updated on {updateDisplayDate}
        </p>
      )}
    </header>

    <!-- Hero Image -->
    {heroImage && (
      <figure class="mb-10 -mx-4 md:mx-0">
        <div class="overflow-hidden rounded-xl md:rounded-2xl bg-base-200">
          <Image
            src={heroImage}
            alt={title}
            width={900}
            height={506}
            class="w-full h-auto"
          />
        </div>
      </figure>
    )}

    <div class="w-full h-px bg-base-300/50 mb-10"></div>

    <!-- Article Content -->
    <div class="prose prose-neutral max-w-none
      prose-headings:font-semibold prose-headings:tracking-tight prose-headings:text-base-content
      prose-h2:text-2xl prose-h2:mt-12 prose-h2:mb-4
      prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-3
      prose-h4:text-lg prose-h4:mt-6 prose-h4:mb-2
      prose-p:text-base-content/70 prose-p:leading-relaxed prose-p:text-[15px]
      prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-a:font-medium
      prose-strong:text-base-content prose-strong:font-semibold
      prose-code:text-sm prose-code:bg-base-200 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:before:content-none prose-code:after:content-none
      prose-pre:bg-base-200 prose-pre:border prose-pre:border-base-300/50 prose-pre:rounded-xl
      prose-blockquote:border-l-2 prose-blockquote:border-base-300 prose-blockquote:pl-4 prose-blockquote:italic prose-blockquote:text-base-content/60
      prose-ul:text-base-content/70 prose-ol:text-base-content/70
      prose-li:text-[15px] prose-li:leading-relaxed
      prose-img:rounded-xl prose-img:shadow-sm
      prose-hr:border-base-300/50
    ">
      <slot />
    </div>

    <!-- Footer -->
    <footer class="mt-16 pt-8 border-t border-base-300/50">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
          <p class="text-sm font-medium text-base-content mb-1">Enjoyed this article?</p>
          <p class="text-xs text-base-content/50">Share it or check out more posts below.</p>
        </div>
        <a
          href="/blog"
          class="inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-base-content bg-base-200/50 rounded-lg border border-base-300/50 hover:bg-base-200 hover:border-base-300 transition-all"
        >
          View all posts
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
          </svg>
        </a>
      </div>
    </footer>
  </article>
</BaseLayout>
