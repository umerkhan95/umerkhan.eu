---
import { Image } from "astro:assets";
import dayjs from "dayjs";

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  heroImage?: ImageMetadata;
  url: string;
  tags?: string[];
  badge?: string;
  index: number;
}

const { title, description, pubDate, heroImage, url, tags = [], badge, index } = Astro.props;
const formattedDate = dayjs(pubDate).format("MMM YYYY");
const formattedIndex = (index + 1).toString().padStart(2, '0');
---

<article class="group relative">
  <a href={url} class="block" data-astro-prefetch>
    <div class="relative pl-12 md:pl-16 py-6">
      <!-- Index Number -->
      <div class="absolute left-0 top-6 flex items-center justify-center">
        <span class="text-3xl md:text-4xl font-bold text-base-content/[0.06] group-hover:text-base-content/[0.12] transition-colors duration-300 select-none">
          {formattedIndex}
        </span>
      </div>

      <!-- Content -->
      <div class="border border-base-300/40 rounded-xl p-5 md:p-6 bg-base-100 group-hover:border-base-300 group-hover:shadow-sm transition-all duration-300">
        <div class="flex flex-col md:flex-row gap-5">
          <!-- Image (if exists) -->
          {heroImage && (
            <div class="flex-shrink-0">
              <div class="w-full md:w-32 h-24 md:h-20 overflow-hidden rounded-lg bg-base-200">
                <Image
                  src={heroImage}
                  width={128}
                  height={80}
                  format="webp"
                  alt={title}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                />
              </div>
            </div>
          )}

          <!-- Text Content -->
          <div class="flex-1 min-w-0">
            <!-- Header -->
            <div class="flex items-start justify-between gap-3 mb-2">
              <h2 class="text-base md:text-lg font-semibold text-base-content group-hover:text-primary transition-colors line-clamp-2 leading-snug">
                {title}
              </h2>
              <svg class="w-4 h-4 text-base-content/30 group-hover:text-primary group-hover:translate-x-0.5 transition-all flex-shrink-0 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>

            <!-- Description -->
            <p class="text-sm text-base-content/60 line-clamp-2 mb-3 leading-relaxed">
              {description}
            </p>

            <!-- Meta -->
            <div class="flex flex-wrap items-center gap-3">
              <span class="text-xs text-base-content/40 flex items-center gap-1.5">
                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                </svg>
                {formattedDate}
              </span>

              {badge && (
                <span class="px-2 py-0.5 text-[10px] font-medium uppercase tracking-wider bg-primary/10 text-primary rounded-full">
                  {badge}
                </span>
              )}

              {tags.length > 0 && (
                <div class="flex flex-wrap gap-1.5">
                  {tags.slice(0, 3).map((tag) => (
                    <span class="px-2 py-0.5 text-[11px] font-medium text-base-content/50 bg-base-200/60 rounded-md">
                      {tag}
                    </span>
                  ))}
                  {tags.length > 3 && (
                    <span class="px-2 py-0.5 text-[11px] font-medium text-base-content/40">
                      +{tags.length - 3}
                    </span>
                  )}
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  </a>
</article>
